{% extends 'base.html' %}

{% block title %}Dashboard - InvestLink{% endblock %}

{% block content %}
<div class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    
    <!-- üéØ Header Compact -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold mb-1">
                        Bonjour, {{ user.get_full_name|default:user.username }} üëã
                    </h1>
                    <p class="text-blue-100 text-sm">
                        {% if user.is_admin_user %}
                            Administrateur
                        {% elif user.can_access_porteur_features %}
                            Porteur de projet
                        {% elif user.can_access_investisseur_features %}
                            Investisseur
                        {% endif %}
                    </p>
                </div>
                <div class="text-right text-sm text-blue-100">
                    <i class="far fa-calendar-alt mr-1"></i>{{ "now"|date:"d/m/Y √† H:i" }}
                </div>
            </div>
        </div>
    </div>
    
    <div class="container mx-auto px-4 py-8">
        
        <!-- üö® Alertes urgentes (si notifications/messages non lus) -->
        {% if unread_messages > 0 or unread_notifications > 0 %}
        <section class="mb-8">
            <div class="grid md:grid-cols-2 gap-4">
                {% if unread_messages > 0 %}
                <a href="{% url 'messaging:inbox' %}" class="bg-gradient-to-r from-yellow-50 to-yellow-100 border-2 border-yellow-300 rounded-lg p-4 hover:shadow-md transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-yellow-900 mb-1 flex items-center">
                                <i class="fas fa-envelope text-yellow-600 mr-2"></i>
                                Nouveaux messages
                            </h3>
                            <p class="text-sm text-yellow-700">Vous avez {{ unread_messages }} message{{ unread_messages|pluralize }} non lu{{ unread_messages|pluralize }}</p>
                        </div>
                        <span class="bg-yellow-600 text-white font-bold text-lg rounded-full w-10 h-10 flex items-center justify-center">
                            {{ unread_messages }}
                        </span>
                    </div>
                </a>
                {% endif %}
                
                {% if unread_notifications > 0 %}
                <a href="{% url 'notifications:list' %}" class="bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-300 rounded-lg p-4 hover:shadow-md transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-blue-900 mb-1 flex items-center">
                                <i class="fas fa-bell text-blue-600 mr-2"></i>
                                Notifications
                            </h3>
                            <p class="text-sm text-blue-700">{{ unread_notifications }} notification{{ unread_notifications|pluralize }} √† consulter</p>
                        </div>
                        <span class="bg-blue-600 text-white font-bold text-lg rounded-full w-10 h-10 flex items-center justify-center">
                            {{ unread_notifications }}
                        </span>
                    </div>
                </a>
                {% endif %}
            </div>
        </section>
        {% endif %}
        
        <!-- üìä KPI Cards Porteur -->
        {% if user.can_access_porteur_features %}
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Mes Projets</h2>
            <div class="grid md:grid-cols-4 gap-6">
                <!-- Total Projets -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-folder text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded">TOTAL</span>
                    </div>
                    <p class="text-3xl font-bold text-gray-900 mb-1">{{ projects_count }}</p>
                    <p class="text-sm text-gray-600">Projet{{ projects_count|pluralize }}</p>
                </div>
                
                <!-- Projets Valid√©s -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded">VALID√âS</span>
                    </div>
                    <p class="text-3xl font-bold text-green-600 mb-1">{{ approved_count }}</p>
                    <p class="text-sm text-gray-600">En ligne</p>
                </div>
                
                <!-- En Attente -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-orange-600 bg-orange-50 px-2 py-1 rounded">ATTENTE</span>
                    </div>
                    <p class="text-3xl font-bold text-orange-500 mb-1">{{ pending_count }}</p>
                    <p class="text-sm text-gray-600">En validation</p>
                </div>
                
                <!-- Investissements Re√ßus -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-hand-holding-usd text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-purple-600 bg-purple-50 px-2 py-1 rounded">RE√áUS</span>
                    </div>
                    <p class="text-3xl font-bold text-purple-600 mb-1">{{ total_investments }}</p>
                    <p class="text-sm text-gray-600">Investissement{{ total_investments|pluralize }}</p>
                </div>
            </div>
        </section>
        
        <!-- üéØ Actions Rapides Porteur (uniquement si pas investisseur) -->
        {% if not user.can_access_investisseur_features %}
        <section class="mb-8">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Actions Rapides</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="{% url 'projects:submit' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-plus-circle text-3xl text-blue-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Nouveau Projet</p>
                </a>
                <a href="{% url 'projects:my_projects' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-green-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-folder-open text-3xl text-green-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Mes Projets</p>
                </a>
                <a href="{% url 'messaging:inbox' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-purple-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-envelope text-3xl text-purple-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Messages</p>
                    {% if unread_messages > 0 %}
                    <span class="inline-block mt-1 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">{{ unread_messages }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'users:profile' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-indigo-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-user-edit text-3xl text-indigo-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Mon Profil</p>
                </a>
            </div>
        </section>
        {% endif %}
        {% endif %}
        
        <!-- üìä KPI Cards Investisseur -->
        {% if user.can_access_investisseur_features %}
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Mon Activit√© d'Investisseur</h2>
            <div class="grid md:grid-cols-4 gap-6">
                <!-- Favoris -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-red-400 to-red-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-heart text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-red-600 bg-red-50 px-2 py-1 rounded">FAVORIS</span>
                    </div>
                    <p class="text-3xl font-bold text-red-600 mb-1">{{ favorites_count }}</p>
                    <p class="text-sm text-gray-600">Projet{{ favorites_count|pluralize }} suivi{{ favorites_count|pluralize }}</p>
                </div>
                
                <!-- Investissements -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-money-bill-wave text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded">INVESTIS</span>
                    </div>
                    <p class="text-3xl font-bold text-green-600 mb-1">{{ investments_count }}</p>
                    <p class="text-sm text-gray-600">Investissement{{ investments_count|pluralize }}</p>
                </div>
                
                <!-- Montant Total -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-dollar-sign text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded">TOTAL</span>
                    </div>
                    <p class="text-3xl font-bold text-blue-600 mb-1">{{ total_invested|floatformat:0 }}</p>
                    <p class="text-sm text-gray-600">$ investis</p>
                </div>
                
                <!-- Projets Disponibles -->
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-briefcase text-white text-xl"></i>
                        </div>
                        <span class="text-xs font-semibold text-purple-600 bg-purple-50 px-2 py-1 rounded">DISPO</span>
                    </div>
                    <p class="text-3xl font-bold text-purple-600 mb-1">{{ available_projects }}</p>
                    <p class="text-sm text-gray-600">√Ä d√©couvrir</p>
                </div>
            </div>
        </section>
        
        <!-- üéØ Actions Rapides Investisseur (uniquement si pas porteur) -->
        {% if not user.can_access_porteur_features %}
        <section class="mb-8">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Actions Rapides</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="{% url 'projects:list' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-search text-3xl text-blue-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">D√©couvrir</p>
                </a>
                <a href="{% url 'projects:my_favorites' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-red-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-heart text-3xl text-red-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Mes Favoris</p>
                </a>
                <a href="{% url 'messaging:inbox' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-purple-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-envelope text-3xl text-purple-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Messages</p>
                    {% if unread_messages > 0 %}
                    <span class="inline-block mt-1 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">{{ unread_messages }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'users:profile' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-indigo-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-user-edit text-3xl text-indigo-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Mon Profil</p>
                </a>
            </div>
        </section>
        {% endif %}
        {% endif %}
        
        <!-- üéØ Actions Rapides Combin√©es (pour les admins ayant les deux acc√®s) -->
        {% if user.can_access_porteur_features and user.can_access_investisseur_features %}
        <section class="mb-8">
            <h3 class="text-lg font-semibold text-gray-700 mb-4">Actions Rapides</h3>
            <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
                <a href="{% url 'projects:submit' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-plus-circle text-3xl text-blue-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Nouveau Projet</p>
                </a>
                <a href="{% url 'projects:my_projects' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-green-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-folder-open text-3xl text-green-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Mes Projets</p>
                </a>
                <a href="{% url 'projects:list' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-cyan-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-search text-3xl text-cyan-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">D√©couvrir</p>
                </a>
                <a href="{% url 'projects:my_favorites' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-red-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-heart text-3xl text-red-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Mes Favoris</p>
                </a>
                <a href="{% url 'messaging:inbox' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-purple-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-envelope text-3xl text-purple-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Messages</p>
                    {% if unread_messages > 0 %}
                    <span class="inline-block mt-1 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">{{ unread_messages }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'users:profile' %}" class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-indigo-500 hover:shadow-md transition text-center group">
                    <i class="fas fa-user-edit text-3xl text-indigo-500 mb-2 group-hover:scale-110 transition"></i>
                    <p class="font-semibold text-gray-900 text-sm">Mon Profil</p>
                </a>
            </div>
        </section>
        {% endif %}
        
        <!-- üìÅ Mes Projets R√©cents (Porteur) -->
        {% if user.can_access_porteur_features %}
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow">
                <button onclick="toggleSection('my-projects')" class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition">
                    <div class="flex items-center">
                        <i class="fas fa-folder-open text-gray-600 mr-3"></i>
                        <h2 class="text-xl font-bold text-gray-900">Mes Projets R√©cents</h2>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform" id="my-projects-icon"></i>
                </button>
                
                <div id="my-projects" class="hidden border-t border-gray-200">
                    <div class="p-6">
                        {% if my_projects %}
                            <div class="space-y-4">
                                {% for project in my_projects %}
                                <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <div class="flex-1">
                                            <h3 class="font-bold text-gray-900 text-lg mb-1">{{ project.title }}</h3>
                                            <p class="text-sm text-gray-600">{{ project.summary|truncatewords:20 }}</p>
                                        </div>
                                        <span class="ml-4 px-3 py-1 text-xs font-semibold rounded-full whitespace-nowrap
                                            {% if project.status == 'submitted' %}bg-gray-200 text-gray-800
                                            {% elif project.status == 'under_review' %}bg-blue-200 text-blue-800
                                            {% elif project.status == 'approved' %}bg-green-200 text-green-800
                                            {% elif project.status == 'rejected' %}bg-red-200 text-red-800
                                            {% elif project.status == 'revision_requested' %}bg-purple-200 text-purple-800
                                            {% endif %}">
                                            {{ project.get_status_display }}
                                        </span>
                                    </div>
                                    <div class="flex flex-wrap items-center justify-between gap-2">
                                        <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500">
                                            <span><i class="far fa-calendar mr-1"></i>{{ project.created_at|date:"d/m/Y" }}</span>
                                            <span><i class="fas fa-dollar-sign mr-1"></i>{{ project.funding_goal|floatformat:0 }} $</span>
                                            {% if project.sector %}
                                            <span><i class="fas fa-tag mr-1"></i>{{ project.get_sector_display }}</span>
                                            {% endif %}
                                        </div>
                                        <a href="{% url 'projects:detail' project.slug %}" class="text-blue-600 hover:text-blue-800 font-medium text-sm whitespace-nowrap">
                                            Voir le projet <i class="fas fa-arrow-right ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="mt-6 text-center">
                                <a href="{% url 'projects:my_projects' %}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition">
                                    Voir tous mes projets <i class="fas fa-arrow-right ml-2"></i>
                                </a>
                            </div>
                        {% else %}
                            <div class="text-center py-12">
                                <i class="fas fa-folder-open text-6xl text-gray-300 mb-4"></i>
                                <p class="text-gray-600 mb-6 text-lg">Vous n'avez pas encore cr√©√© de projet</p>
                                <a href="{% url 'projects:submit' %}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition">
                                    <i class="fas fa-plus mr-2"></i>Cr√©er mon premier projet
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>
        
        <!-- üìà Statistiques D√©taill√©es Porteur -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow">
                <button onclick="toggleSection('porteur-stats')" class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-gray-600 mr-3"></i>
                        <h2 class="text-xl font-bold text-gray-900">Statistiques D√©taill√©es</h2>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform" id="porteur-stats-icon"></i>
                </button>
                
                <div id="porteur-stats" class="hidden border-t border-gray-200">
                    <div class="p-6">
                        <div class="grid md:grid-cols-3 gap-6">
                            <!-- Projets par statut -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                    <i class="fas fa-list-check text-blue-600 mr-2"></i>
                                    Projets par Statut
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Valid√©s</span>
                                        <span class="text-xl font-bold text-green-600">{{ approved_count }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">En attente</span>
                                        <span class="text-xl font-bold text-orange-600">{{ pending_count }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">R√©vision demand√©e</span>
                                        <span class="text-xl font-bold text-purple-600">{{ revision_count }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Refus√©s</span>
                                        <span class="text-xl font-bold text-red-600">{{ rejected_count }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Financement -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                    <i class="fas fa-money-bill-wave text-green-600 mr-2"></i>
                                    Financement
                                </h3>
                                <div class="space-y-3">
                                    <div class="p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                        <p class="text-sm text-gray-600 mb-1">Total re√ßu</p>
                                        <p class="text-3xl font-bold text-green-600">{{ total_funding_received|floatformat:0 }} $</p>
                                    </div>
                                    <div class="p-3 bg-blue-50 rounded-lg">
                                        <p class="text-sm text-gray-600 mb-1">Investissements</p>
                                        <p class="text-2xl font-bold text-blue-600">{{ total_investments }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Activit√© (7 jours) -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                    <i class="fas fa-clock text-orange-600 mr-2"></i>
                                    Activit√© (7 jours)
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Nouveaux projets</span>
                                        <span class="text-xl font-bold text-blue-600">{{ projects_week }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Investissements</span>
                                        <span class="text-xl font-bold text-purple-600">{{ investments_week }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Messages re√ßus</span>
                                        <span class="text-xl font-bold text-green-600">{{ messages_received_week }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
        
        <!-- ‚ù§Ô∏è Mes Projets Favoris (Investisseur) -->
        {% if user.can_access_investisseur_features %}
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow">
                <button onclick="toggleSection('favorites')" class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition">
                    <div class="flex items-center">
                        <i class="fas fa-heart text-gray-600 mr-3"></i>
                        <h2 class="text-xl font-bold text-gray-900">Mes Projets Favoris</h2>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform" id="favorites-icon"></i>
                </button>
                
                <div id="favorites" class="hidden border-t border-gray-200">
                    <div class="p-6">
                        {% if favorite_projects %}
                            <div class="grid md:grid-cols-2 gap-4">
                                {% for favorite in favorite_projects %}
                                <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition">
                                    <div class="flex items-start justify-between mb-3">
                                        <h3 class="font-bold text-gray-900 flex-1">{{ favorite.project.title }}</h3>
                                        <i class="fas fa-heart text-red-500 ml-2"></i>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">{{ favorite.project.summary|truncatewords:15 }}</p>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-3 text-sm text-gray-500">
                                            <span><i class="fas fa-dollar-sign mr-1"></i>{{ favorite.project.funding_goal|floatformat:0 }} $</span>
                                            {% if favorite.project.sector %}
                                            <span><i class="fas fa-tag mr-1"></i>{{ favorite.project.get_sector_display|truncatewords:2 }}</span>
                                            {% endif %}
                                        </div>
                                        <a href="{% url 'projects:detail' favorite.project.slug %}" class="text-blue-600 hover:text-blue-800 font-medium text-sm whitespace-nowrap">
                                            Voir <i class="fas fa-arrow-right ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="mt-6 text-center">
                                <a href="{% url 'projects:my_favorites' %}" class="inline-block bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-2 rounded-lg transition">
                                    Voir tous mes favoris <i class="fas fa-arrow-right ml-2"></i>
                                </a>
                            </div>
                        {% else %}
                            <div class="text-center py-12">
                                <i class="fas fa-heart text-6xl text-gray-300 mb-4"></i>
                                <p class="text-gray-600 mb-6 text-lg">Vous n'avez pas encore de projets favoris</p>
                                <a href="{% url 'projects:list' %}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition">
                                    <i class="fas fa-search mr-2"></i>D√©couvrir des projets
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>
        
        <!-- üìà Statistiques D√©taill√©es Investisseur -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow">
                <button onclick="toggleSection('investor-stats')" class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition">
                    <div class="flex items-center">
                        <i class="fas fa-chart-pie text-gray-600 mr-3"></i>
                        <h2 class="text-xl font-bold text-gray-900">Mon Activit√© d'Investissement</h2>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform" id="investor-stats-icon"></i>
                </button>
                
                <div id="investor-stats" class="hidden border-t border-gray-200">
                    <div class="p-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Mes investissements -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                    <i class="fas fa-wallet text-green-600 mr-2"></i>
                                    Mes Investissements
                                </h3>
                                <div class="space-y-3">
                                    <div class="p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                        <p class="text-sm text-gray-600 mb-1">Montant total investi</p>
                                        <p class="text-3xl font-bold text-green-600">{{ total_invested|floatformat:0 }} $</p>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Confirm√©s</span>
                                        <span class="text-xl font-bold text-blue-600">{{ investments_confirmed }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">En attente</span>
                                        <span class="text-xl font-bold text-orange-600">{{ investments_pending }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Activit√© r√©cente -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                    <i class="fas fa-clock text-purple-600 mr-2"></i>
                                    Activit√© (7 jours)
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Nouveaux favoris</span>
                                        <span class="text-xl font-bold text-red-600">{{ favorites_week }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Investissements</span>
                                        <span class="text-xl font-bold text-green-600">{{ investments_week }}</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Nouveaux projets</span>
                                        <span class="text-xl font-bold text-blue-600">{{ new_projects_week }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Secteurs favoris -->
                        {% if favorite_sectors %}
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                                <i class="fas fa-star text-yellow-600 mr-2"></i>
                                Mes Secteurs Pr√©f√©r√©s
                            </h3>
                            <div class="grid grid-cols-3 gap-3">
                                {% for sector in favorite_sectors %}
                                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 text-center border border-blue-200">
                                    <p class="text-2xl font-bold text-blue-600 mb-1">{{ sector.count }}</p>
                                    <p class="text-xs text-gray-600 font-medium">{{ sector.project__sector|default:"Non d√©fini" }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
        
    </div>
</div>

<!-- Script pour les accord√©ons -->
<script>
function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const icon = document.getElementById(sectionId + '-icon');
    
    if (section.classList.contains('hidden')) {
        section.classList.remove('hidden');
        icon.classList.add('rotate-180');
    } else {
        section.classList.add('hidden');
        icon.classList.remove('rotate-180');
    }
}
</script>

<style>
    .badge-submitted { @apply bg-gray-200 text-gray-800 text-xs px-2 py-1 rounded; }
    .badge-under_review { @apply bg-blue-200 text-blue-800 text-xs px-2 py-1 rounded; }
    .badge-revision_requested { @apply bg-purple-200 text-purple-800 text-xs px-2 py-1 rounded; }
    .badge-approved { @apply bg-green-200 text-green-800 text-xs px-2 py-1 rounded; }
    .badge-rejected { @apply bg-red-200 text-red-800 text-xs px-2 py-1 rounded; }
</style>
{% endblock %}
